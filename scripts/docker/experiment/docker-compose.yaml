services:
  producer:
    image: openjdk:21-jdk
    command: java -Xms1536m -Xmx1536m -jar /app/data-generator-jar-with-dependencies.jar
    deploy:
      resources:
        limits:
          cpus: '3'
          memory: 4gb
        reservations:
          cpus: '3'
          memory: 4gb
    # deploy:
    #   mode: replicated
    #   replicas: 6
    volumes:
      - ./runtime:/app
      - ./dataset:/dataset
    environment:
      DATA: STATS
      # DATA: RAW
      MESSAGE_SIZE: 16384 ## 16k
    # networks:
    #   - maestro-network
    extra_hosts:
      kafka-0: 201.23.74.39
      kafka-1: 201.23.74.39
      kafka-2: 201.23.74.39
  # stream-vanilla:
  #   image: openjdk:21-jdk
  #   command: java -Xms2560m -Xmx2560m -jar /app/sample-stream-jar-with-dependencies.jar --app-id streams --test-id vanilla --type VANILLA --topology STATS
  #   # command: java -Xms2560m -Xmx2560m -jar /app/sample-stream-jar-with-dependencies.jar --app-id streams --test-id vanilla --type VANILLA --topology PASSTHROUGH
  #   deploy:
  #     # replicas: 2
  #     resources:
  #       limits:
  #         cpus: '4'
  #         memory: 6gb
  #       reservations:
  #         cpus: '0.5'
  #         memory: 6gb
  #   environment:
  #     STATS_FOLDER: /app-stats
  #   volumes:
  #     - ./runtime:/app
  #     - ./stats/vanilla:/app-stats
  #   # networks:
  #   #   - maestro-network
  #   extra_hosts:
  #     kafka-0: 201.23.74.39
  #     kafka-1: 201.23.74.39
  #     kafka-2: 201.23.74.39
  stream-maestro:
    image: openjdk:21-jdk
    command: java -Xms2560m -Xmx2560m -jar /app/sample-stream-jar-with-dependencies.jar --app-id streams --test-id maestro --type MAESTRO --topology STATS
    # command: java -Xms2560m -Xmx2560m -jar /app/sample-stream-jar-with-dependencies.jar --app-id streams --test-id maestro --type MAESTRO --topology PASSTHROUGH
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 6gb
        reservations:
          cpus: '0.5'
          memory: 6gb
    environment:
      STATS_FOLDER: /app-stats
    volumes:
      - ./runtime:/app
      - ./stats/maestro:/app-stats
    # networks:
    #   - maestro-network
    extra_hosts:
      kafka-0: 201.23.74.39
      kafka-1: 201.23.74.39
      kafka-2: 201.23.74.39
networks:
  maestro-network:
    ## local
    # external: true
    ## cloud
    name: maestro-network
    driver: bridge