version: '3'
services:
  producer:
    image: openjdk:21-jdk
    command: java -jar /app/data-generator-jar-with-dependencies.jar -d /app/train-data -t 10 -r 20000 train
    deploy:
      mode: replicated
      replicas: 2
    volumes:
      - ./runtime:/app
    networks:
      - maestro-network
  stream-default:
    image: openjdk:21-jdk
    command: java -jar /app/sample-stream-jar-with-dependencies.jar
    deploy:
      resources:
        limits:
          cpus: 1
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 256M
    environment:
      APP_ID: stream-default
      PARAMETER_NAME: max.partition.fetch.bytes
      PARAMETER_VALUE: 1048576
      STATS_FOLDER: /app/stats
      TEST_ID: default
    volumes:
      - ./runtime:/app
      - ./stats/default:/app/stats
    networks:
      - maestro-network
  stream-low: ## -25%
    image: openjdk:21-jdk
    command: java -jar /app/sample-stream-jar-with-dependencies.jar
    deploy:
      resources:
        limits:
          cpus: 1
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 256M
    environment:
      APP_ID: stream-low
      PARAMETER_NAME: max.partition.fetch.bytes
      PARAMETER_VALUE: 786432
      STATS_FOLDER: /app/stats
      TEST_ID: low
    volumes:
      - ./runtime:/app
      - ./stats/low:/app/stats
    networks:
      - maestro-network
  stream-high: ## +25%
    image: openjdk:21-jdk
    command: java -jar /app/sample-stream-jar-with-dependencies.jar
    deploy:
      resources:
        limits:
          cpus: 1
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 256M
    environment:
      APP_ID: stream-high
      PARAMETER_NAME: max.partition.fetch.bytes
      PARAMETER_VALUE: 1310720
      STATS_FOLDER: /app/stats
      TEST_ID: high
    volumes:
      - ./runtime:/app
      - ./stats/high:/app/stats
    networks:
      - maestro-network
networks:
  maestro-network:
    external: true