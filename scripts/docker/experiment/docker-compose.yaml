services:
  producer:
    image: openjdk:21-jdk
    command: java -jar /app/data-generator-jar-with-dependencies.jar
    # deploy:
    #   mode: replicated
    #   replicas: 6
    volumes:
      - ./runtime:/app
    networks:
      - maestro-network
  stream-vanilla:
    image: openjdk:21-jdk
    command: java -Xms1g -Xmx1g -jar /app/sample-stream-jar-with-dependencies.jar --app-id vanilla --test-id vanilla --type VANILLA
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 1.5gb
        reservations:
          cpus: '0.5'
          memory: 1.5gb
    environment:
      STATS_FOLDER: /app/stats
    volumes:
      - ./runtime:/app
      - ./stats/vanilla:/app/stats
    networks:
      - maestro-network
  stream-maestro:
    image: openjdk:21-jdk
    command: java -Xms1g -Xmx1g -jar /app/sample-stream-jar-with-dependencies.jar --app-id maestro --test-id maestro --type MAESTRO
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 1.5gb
        reservations:
          cpus: '0.5'
          memory: 1.5gb
    environment:
      STATS_FOLDER: /app/stats
    volumes:
      - ./runtime:/app
      - ./stats/maestro:/app/stats
    networks:
      - maestro-network
networks:
  maestro-network:
    external: true